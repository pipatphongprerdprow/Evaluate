<template>
    <div class="col md:col-12 text-right">
        <Button label="Export" icon="pi pi-file-word" class="mr-2 mb-2 " @click="printDataP01"></Button>
    </div> 
    <div class="card">
        <h3 class="mb-4" style="text-align: left;">
            <i class="pi pi-folder-open" style="font-size: x-large;"></i> แบบ ป02
        </h3>
        <h4>
            ข้อตกลงและแบบการประเมินผลสัมฤทธิ์ของงานของข้าราชการและพนักงาน 
            สังกัดมหาวิทยาลัยมหาสารคาม (องค์ประกอบที่ 2)
        </h4>
        <br> 
        <div class="p-fluid formgrid grid">  
            <!-- ตาราง ก. สมรรถนะหลัก -->
            <div class="field col-12 md:col-4"> 
                <table id="ratingTable">
                    <thead>
                        <tr>
                            <th style="width: 40%;">ก. สมรรถนะหลัก (สำหรับข้าราชการและพนักงานทุกคน)</th>
                            <th style="width: 20%;">(1)ระดับ<br>สมรรถนะ<br>ที่คาดหวัง</th>
                            <th style="width: 20%;">ระดับ<br>สมรรถนะ<br>ประเมินตนเอง</th>
                            <th style="width: 20%;">(2)ระดับ<br>สมรรถนะ<br>ที่แสดงออก</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(row1, index) in coreCompetencies" :key="index">
                            <td
                                style="text-align: left; cursor: pointer; color: #0d47a1;"
                                @click="openCompetencyDialog('core', row1)" >
                                {{ row1.activity }}
                            </td>  
                            <td>
                                <p>{{ row1.indicator }}</p>
                            </td>   
                            <td>  
                                <b v-if="row1.selfAssessment == '' ||  row1.selfAssessment == null" style="color: red;">0</b> 
                                <b v-if="row1.selfAssessment != 0 " style="color: blue" >{{ row1.selfAssessment }}</b> 
                            </td>
                            <td>  
                                <b v-if="row1.data_table1 == '' " style="color: red;">0</b> 
                                <b v-if="row1.data_table1 != 0 " >{{ row1.data_table1 }}</b> 
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div> 

            <!-- ตาราง ข. สมรรถนะเฉพาะตามลักษณะงานที่ปฏิบัติ -->
            <div class="field col-12 md:col-4"> 
                <table id="ratingTable">
                    <thead>
                        <tr>
                            <th style="width: 50%;">ข. สมรรถนะเฉพาะตามลักษณะงานที่ปฏิบัติ (สำหรับข้าราชการและพนักงานเฉพาะตามตำแหน่งที่รับผิดชอบตามที่ ก.บ.ม. กำหนด)</th>
                            <th style="width: 20%;">(3)ระดับ<br>สมรรถนะ<br>ที่คาดหวัง</th>
                            <th style="width: 20%;">ระดับ<br>สมรรถนะ<br>ประเมินตนเอง</th>
                            <th style="width: 20%;">(4)ระดับ<br>สมรรถนะ<br>ที่แสดงออก</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(row2, index) in jobSpecificCompetencies" :key="index"> 
                            <td
                                style="text-align: left; cursor: pointer; color: #0d47a1;"
                                @click="openCompetencyDialog('job', row2, index)"
                            >
                                ข. {{ index + 1 }} {{ row2.WORK_NAME }}
                            </td> 
                            <td>{{ row2.COMPLEVEL }}</td>  

                            <td>  
                                <b v-if="row2.SCOREPERSON == '' || row2.SCOREPERSON == null" style="color: red;">0</b> 
                                <b v-if="row2.SCOREPERSON != 0 " style="color: blue;" >{{ row2.SCOREPERSON }}</b> 
                            </td>
                            <td> 
                                <b v-if="row2.SCORE == null || row2.SCORE == '' " style="color: red;">0</b> 
                                <b v-if="row2.SCORE != 0 " >{{ row2.SCORE }}</b> 
                            </td> 
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ตาราง ค. สมรรถนะทางการบริหาร -->
            <div class="field col-12 md:col-4"> 
                <table id="ratingTable">
                    <thead>
                        <tr>
                            <th style="width: 60%;">ค. สมรรถนะทางการบริหาร (สำหรับตำแหน่งประเภทบริหารตามที่ ก.บ.ม. กำหนด)</th>
                            <th style="width: 20%;">(5)ระดับ<br>สมรรถนะ<br>ที่คาดหวัง</th>
                            <th style="width: 20%;">ระดับ<br>สมรรถนะ<br>ประเมิน<br>ตนเอง</th>
                            <th style="width: 20%;">(6)ระดับ<br>สมรรถนะ<br>ที่แสดง<br>ออก</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(row3, index) in otherCompetencies" :key="index">
                            <td
                                style="text-align: left; cursor: pointer; color: #0d47a1;"
                                @click="openCompetencyDialog('other', row3)"
                            >
                                {{ row3.activity }}
                            </td> 
                            <td>
                                <b v-if="row3.indicator3 == '' ||  row3.indicator3 == null" style="color: red;">-</b>
                                <span v-if="row3.indicator3 != 0">{{ row3.indicator3 }}</span>  
                            </td>
                            <td>  
                                <b v-if="row3.datatable3 == '' ||  row3.datatable3 == null" style="color: red;">-</b> 
                                <b v-if="row3.datatable3 != 0 " style="color: blue" >{{ row3.datatable3 }}</b> 
                            </td>
                            <td>  
                                <b v-if="row3.selfAssessment3 == '' ||  row3.selfAssessment3 == null" style="color: red;">-</b>  
                                <b v-if="row3.selfAssessment3 != 0 " >{{ row3.selfAssessment3 }}</b> 
                            </td>
                        </tr> 
                    </tbody>
                </table> 
            </div>
        </div> 
    </div>
  
    <Dialog
        header="รายละเอียดสมรรถนะ"
        v-model:visible="competencyDialogVisible"
        :modal="true"
        :style="{ width: '80vw' }"
    >
        <h4>{{ selectedCompetency.title }}</h4>
        <p style="white-space: pre-line;">
            {{ selectedCompetency.description }}
        </p>
    </Dialog> 
    <br>
    <div class="p-fluid formgrid grid"> 
        <b><h4>ความเห็นเพิ่มเติมของผู้ประเมิน (ระบุข้อมูลเมื่อสิ้นรอบการประเมิน)</h4></b>
        <div class="field col-12 md:col-12">  
            <label for="improvements">1) จุดเด่น และ/หรือ สิ่งที่ควรปรับปรุงแก้ไข</label>
            <p style="margin-left: 20px;">{{ improvements ?? '- ไม่มีข้อมูล -' }}</p>
        </div>
        <div class="field col-9 md:col-9">  
            <label for="suggestions">2) ข้อเสนอแนะเกี่ยวกับวิธีส่งเสริมและพัฒนา</label>
            <p style="margin-left: 20px;">{{ suggestions ?? '- ไม่มีข้อมูล -' }}</p> 
        </div>
    </div>  
</template>

<script>
import { ref } from 'vue';
import axios from 'axios';  
import Swal from 'sweetalert2' 
import InputText from 'primevue/inputtext';

//รอใส่230269 ประเมิน ค.
const EXECUTIVE_ALLOWLIST = new Set([
'160018',//นายจีรพันธ์ ภูครองเพชร
'190015',//นางนงลักษณ์ พุ่มม่วง
'130069',//นายขรรชัย กลิ่นผกา
'110143',//นางวราลักษณ์ คุปต์บดินทร
'190042',//นางฉวีวรรณ คืนสันเทียะ
'110105',//นายจักริน เพชรสังหาร
'1140016',//นางบงกชทิพย์ เกาะสมบัต
'110407',//นายอานุภาพ งามสูงเนิน
'110138',//นางฉันทลักษณ์ สาชำนาญ
'120039',//นางสุชาราวตี มาบุญธรรม
'110142',//นางสาวอุทัยรัตน์ แก้วกู่
'120032',//นางวิรายา ภมรสมิต
'1100017',//นางพัชรนันญ ศรีแก่นจันทร
'190021',//นางศิโรวรรณ อินศร
'5002279',//นางสาวอนงค์ภาณุช ปะนะทังถิรวิทย
'140056',//นางฉวีวรรณ อรรคะเศรษฐัง
'110146',//นายนิวัฒ พัฒนิบูลย
'110108',//นางสาวดวงแข เนื่องอุดม
'110144',//นายอุทัย หามนตร
'110309',//นางมยุรี ผาผง
'130076',//นางกมลลักษณ์ พักพิงผ่องศิร
'140066',//นางอมรรัตน์ หลายโคตร
'190032',//นางชนัญชิดา สุวรรณเลิศ
'110148',//นางจุฑามาศ ภิญโญศร
'180010',//นางสิรีวรรณ ตติยรัตน
'140064',//นางพรทิพย์ พันธุมชัย
'120043',//นางลัดดาภรณ์ เชื้อในเขา
'5001661',//นางศรินทร์ยา เกียงขวา
'5001685',//นางแจ่มจันทร์ หลูปรีชาเศรษฐ
'310801',//นางสาวกนกวรรณ เชาว์น้อย
'410402',//นายนพวิทย์ ศรีเวียงธนาธิป
'314020',//นายไกรษร อุทัยแสง
'5000094',//นายสวัสดิ์ วิชระโภชน
'130102' //นางสาวพนมพร ปัจจวงษ
  
]);

export default {
    props: {
        dataPor: {
            type: Object,
            required: true
        },
        tab2Reload: {
            type: String,
            default: '0'
        } 
    },
    data() {
        return {
            // ตาราง ก. สมรรถนะหลัก
            coreCompetencies: [
                { id: 1, activity: 'ก. 1 การมุ่งผลสัมฤทธิ์', indicator: '', data_table1: '', selfAssessment:'' },
                { id: 2, activity: 'ก. 2 การบริการที่ดี', indicator: '', data_table1: '', selfAssessment:'' },
                { id: 3, activity: 'ก. 3 การสั่งสมความเชี่ยวชาญในงานอาชีพ', indicator: '', data_table1: '', selfAssessment:'' },
                { id: 4, activity: 'ก. 4 การยึดมั่นในความถูกต้องชอบธรรมและจริยธรรม', indicator: '', data_table1: '', selfAssessment:'' },
                { id: 5, activity: 'ก. 5 การทำงานเป็นทีม', indicator: '', data_table1: '', selfAssessment:'' }
            ],
            // ตาราง ข. สมรรถนะเฉพาะตามลักษณะงานที่ปฏิบัติ
            jobSpecificCompetencies: [], 
             
            // ตาราง ค. สมรรถนะทางการบริหาร
            otherCompetencies: [
                { id: 12, activity: 'ค. 1 สภาวะผู้นำ', indicator3: '0', datatable3: '', selfAssessment3:''},
                { id: 13, activity: 'ค. 2 วิสัยทัศน์', indicator3: '0', datatable3: '', selfAssessment3:'' },
                { id: 14, activity: 'ค. 3 การวางกลยุทธ์ภาครัฐ', indicator3: '0', datatable3: '', selfAssessment3:'' },
                { id: 15, activity: 'ค. 4 ศักยภาพเพื่อนำการปรับเปลี่ยน', indicator3: '0', datatable3: '', selfAssessment3:'' },
                { id: 16, activity: 'ค. 5 การสอนงานและการมอบหมายงาน', indicator3: '0', datatable3: '', selfAssessment3:'' }
            ],  

            postypetext: null,
            posadio: 0,

            improvements: null,
            suggestions: null,
 
            // fallback คำอธิบายสมรรถนะหลัก
            coreDescriptions: {
                1: 'คำอธิบาย ก.1 การมั่งผลสัมฤทธ์\n\n' +
                    'ความมุ่งมั่นจะปฏิบัติหน้าที่ราชการให้ดีหรือให้เกินมาตรฐานที่มีอยู่ โดยมาตรฐานนี้อาจเป็นผลการปฏิบัติงานที่ผ่านมาของตนเอง หรือเกณฑ์วัดผลสัมฤทธิ์ที่สถาบันอุดมศึกษา ' +
                    'กำหนดขึ้น อีกทั้งยังหมายรวมถึงการสร้างสรรค์พัฒนาผลงานหรือกระบวนการปฏิบัติงานตามเป้าหมายที่ยากและท้าท้ายชนิดที่อาจไม่เคยมีผู้ใดสามารถกระทำได้มาก่อน\n\n' +  
                    'ระดับที่ 0 ไม่แสดงสมรรถนะด้านนี้ หรือแสดงอย่างไม่ชัดเจน\n\n' +  
                    'ระดับที่ 1 แสดงความพยายามในการปฏิบัติหน้าที่ราชการให้ดี\n' +
                        '- พยายามทำงานในหน้าที่ให้ถูกต้อง\n' +
                        '- พยายามปฏิบัติงานให้แล้วเสร็จตามกำหนดเวลา\n' +
                        '- มานะอดทน ขยันหมั่นเพียรในการทำงาน\n' +
                        '- แสดงออกว่าต้องการทำงานให้ได้ดีขึ้น\n' + 
                        '- แสดงความเห็นในเชิงปรับปรุงพัฒนาเมื่อเห็นความสูญเปล่า หรือหย่อนประสิทธิภาพในงาน\n\n' +  
                    'ระดับที่ 2 แสดงสมรรถนะระดับที่ 1 และสามารถทำงานได้ผลงานตามเป้าหมายที่วางไว้\n' + 
                        '- กำหนดมาตรฐาน หรือเป้าหมายในการทำงานเพื่อให้ได้ผลงานที่ดี\n' + 
                        '- ติดตาม และประเมินผลงานของตน โดยเทียบเคียงกับเกณฑ์มาตรฐาน\n' + 
                        '- ทำงานได้ตามเป้าหมายที่ผู้บังคับบัญชากำหนด หรือเป้าหมายของหน่วยงานที่รับผิดชอบ\n' + 
                        '- ทำงานได้ตามเป้าหมายที่ผู้บังคับบัญชากำหนด หรือเป้าหมายของหน่วยงานที่รับผิดชอบ\n' + 
                        '- มีความละเอียดรอบคอบ เอาใจใส่ ตรวจตราความถูกต้อง เพื่อให้ได้งานที่มีคุณภาพ\n\n' +  
                    'ระดับที่ 3 แสดงสมรรถนะระดับที่ 2 และสามารถปรับปรุงวิธีการทำงานเพื่อให้ได้ผลงานที่มีประสิทธิภาพมากยิ่งขึ้น\n' +
                        '- ปรับปรุงวิธีการที่ทำให้งานได้ดีขึ้น เร็วขึ้น มีคุณภาพดีขึ้น มีประสิทธิภาพมากขึ้น หรือทำให้ผู้บริการพึงพอใจมากขึ้น\n' + 
                        '- เสนอหรือทดลองวิธีการทำงานแบบใหม่ที่คาดว่าจะทำให้งานมีประสิทธิภาพมากขึ้น\n\n' +  
                    'ระดับที่ 4 แสดงสมรรถนะระดับที่ 3 และสามารถกำหนดเป้าหมายรวมทั้งพัฒนางาน เพื่อให้ได้ผลงานที่โดดเด่น หรือแตกต่างอย่างมีนัยสำคัญ\n' +
                        '- กำหนดเป้าหมายที่ท้าทาย และเป็นไปได้ยาก เพื่อให้ได้ผลงานที่ดีกว่าเดิมอย่างเห็นได้ชัด\n' + 
                        '- พัฒนาระบบ ขั้นตอน วิธีการทำงาน เพื่อให้ได้ผลงานที่โดดเด่น หรือแตกต่างไม่เคยมีผู้ใดทำได้มาก่อน\n\n' +    
                    'ระดับที่ 5 แสดงสมรรถนะระดับที่ 4 และกล้าตัดสินใจ แม้ว่าการตัดสินใจนั้นจะมีความเสี่ยงเพื่อให้บรรลุเป้าหมายของหน่วยงานหรือสถาบันอุดมศึกษา\n' +
                        '- ตัดสินใจได้ โดยมีการคำนวณผลได้ผลเสียอย่างชัดเจน และดำเนินการ เพื่อให้ภาครัฐและประชาชนได้ประโยชน์สูงสุด\n' +
                        '- บริหารจัดการและทุ่มเทเวลา ตลอดจนทรัพยากร เพื่อให้ได้ประโยชน์สูงสุดต่อภารกิจของหน่วยงานตามที่วางแผนไว้', 

 
                2:  'คำอธิบาย ก.2 การบริการที่ดี\n\n' +
                    'ความตั้งใจและความพยายามของข้าราชการ และพนักงานในการให้บริการต่อประชาชน ข้าราชการ หรือหน่วยงานอื่น ๆ ที่เกี่ยวข้อง\n\n' +
                    'ระดับที่ 0 ไม่แสดงสมรรถนะด้านนี้ หรือแสดงอย่างไม่ชัดเจน\n\n' +
                    'ระดับที่ 1 ให้บริการพื้นฐานได้อย่างเหมาะสม\n' +
                        '- ให้บริการด้วยท่าทีเป็นมิตร สุภาพ และให้ข้อมูลข่าวสารที่ถูกต้อง ชัดเจน\n' +
                        '- แจ้งความคืบหน้าการดำเนินเรื่อง และประสานงานกับหน่วยงานที่เกี่ยวข้องเพื่อให้บริการต่อเนื่อง\n\n' +
                    'ระดับที่ 2 แสดงสมรรถนะระดับที่ 1 และช่วยแก้ปัญหาให้ผู้รับบริการ\n' +
                        '- รับผิดชอบช่วยแก้ปัญหาหรือหาแนวทางแก้ไขให้ผู้รับบริการอย่างรวดเร็ว ไม่บ่ายเบี่ยง\n' +
                        '- เก็บข้อขัดข้องจากการให้บริการมาใช้ปรับปรุงคุณภาพการบริการ\n\n' +
                    'ระดับที่ 3 แสดงสมรรถนะระดับที่ 2 และให้บริการเกินกว่าที่คาดหวัง\n' +
                        '- สละเวลาและความพยายามเพิ่มเติมเพื่อช่วยเหลือผู้รับบริการให้ปัญหาคลี่คลาย\n' +
                        '- ให้ข้อมูลหรือคำแนะนำเพิ่มเติมที่เป็นประโยชน์ แม้ผู้รับบริการไม่ได้ถามโดยตรง\n' +
                        '- เสนอวิธีให้บริการรูปแบบใหม่ ๆ เพื่อให้ผู้รับบริการได้รับประโยชน์สูงสุด\n\n' +
                    'ระดับที่ 4 แสดงสมรรถนะระดับที่ 3 และเข้าใจความต้องการที่แท้จริงของผู้รับบริการ\n' +
                        '- พยายามทำความเข้าใจเบื้องลึกถึงความจำเป็นและปัญหาของผู้รับบริการ\n' +
                        '- ให้คำแนะนำที่ตอบโจทย์ความจำเป็นที่แท้จริง ไม่ใช่เพียงตามคำร้องขอเบื้องต้น\n\n' +
                    'ระดับที่ 5 แสดงสมรรถนะระดับที่ 4 และมุ่งประโยชน์ระยะยาวของผู้รับบริการ\n' +
                        '- พร้อมปรับวิธีหรือขั้นตอนการให้บริการ เพื่อประโยชน์สูงสุดของผู้รับบริการในระยะยาว\n' +
                        '- ทำหน้าที่คล้ายที่ปรึกษาที่ผู้รับบริการให้ความไว้วางใจในการตัดสินใจ\n' +
                        '- กล้าเสนอแนวทางที่ต่างจากวิธีที่ผู้รับบริการร้องขอ หากเห็นว่าเป็นประโยชน์แท้จริงต่อเขา',

                3: 'คำอธิบาย ก.3 การสั่งสมความเชี่ยวชาญในงานอาชีพ\n\n' +
                    'ความสนใจใฝ่รู้ สั่งสมความรู้และความสามารถของตนด้วยการศึกษา ค้นคว้า และพัฒนาตนเองอย่างต่อเนื่อง ' +
                    'จนสามารถประยุกต์ใช้ความรู้เชิงวิชาการและเทคโนโลยีต่าง ๆ เข้ากับการปฏิบัติราชการให้เกิดผลสัมฤทธิ์\n\n' +
                    'ระดับที่ 0 ไม่แสดงสมรรถนะด้านนี้ หรือแสดงอย่างไม่ชัดเจน\n\n' +
                    'ระดับที่ 1 ติดตามและแสวงหาความรู้ใหม่ในสาขาอาชีพของตน\n' +
                        '- สนใจศึกษาเทคโนโลยีและองค์ความรู้ใหม่ ๆ ที่เกี่ยวข้องกับงาน\n' +
                        '- พยายามเพิ่มพูนความรู้ความสามารถของตนจากแหล่งข้อมูลต่าง ๆ\n\n' +
                    'ระดับที่ 2 แสดงสมรรถนะระดับที่ 1 และมีความรู้ในวิชาการ/เทคโนโลยีใหม่ในสายงานของตน\n' +
                        '- มีความเข้าใจที่ดีในองค์ความรู้หรือเทคโนโลยีใหม่ที่เกี่ยวข้องกับงาน\n' +
                        '- มองเห็นแนวโน้มพัฒนาการทางวิชาการที่มีผลต่อการทำงานของตน\n\n' +
                    'ระดับที่ 3 แสดงสมรรถนะระดับที่ 2 และนำความรู้หรือเทคโนโลยีใหม่มาปรับใช้ในการทำงาน\n' +
                        '- ประยุกต์ใช้วิทยาการหรือเทคโนโลยีใหม่ในการปรับปรุงวิธีทำงานให้มีประสิทธิภาพยิ่งขึ้น\n' +
                        '- แก้ปัญหาที่เกิดจากการใช้เทคโนโลยีใหม่ในการปฏิบัติงานได้\n\n' +
                    'ระดับที่ 4 แสดงสมรรถนะระดับที่ 3 และพัฒนาตนเองให้มีความเชี่ยวชาญทั้งลึกและกว้าง\n' +
                        '- มีความรู้เชิงบูรณาการครอบคลุมหลายสาขา และสามารถนำไปใช้ได้หลากหลายบริบท\n' +
                        '- ใช้ความรู้ที่มีในการช่วยกำหนดวิสัยทัศน์หรือแนวทางพัฒนางานในอนาคต\n\n' +
                    'ระดับที่ 5 แสดงสมรรถนะระดับที่ 4 และส่งเสริมให้องค์กรมีบรรยากาศแห่งความเชี่ยวชาญ\n' +
                        '- สนับสนุนการจัดสรรทรัพยากรและเครื่องมือเพื่อให้บุคลากรได้พัฒนาความเชี่ยวชาญ\n' +
                        '- ผลักดันให้องค์กรนำเทคโนโลยีหรือองค์ความรู้ใหม่ ๆ มาใช้ในงานราชการอย่างต่อเนื่อง',

                4: 'คำอธิบาย ก.4 การยึดมั่นในความถูกต้องชอบธรรมและจริยธรรม\n\n' +
                    'การดำรงตนและประพฤติปฏิบัติอย่างถูกต้องเหมาะสมตามกฎหมาย คุณธรรม จรรยาบรรณแห่งวิชาชีพ ' +
                    'และจรรยาข้าราชการ พนักงาน เพื่อรักษาศักดิ์ศรีแห่งความเป็นข้าราชการ พนักงาน\n\n' +
                    'ระดับที่ 0 ไม่แสดงสมรรถนะด้านนี้ หรือแสดงอย่างไม่ชัดเจน\n\n' +
                    'ระดับที่ 1 ปฏิบัติงานด้วยความสุจริตและโปร่งใส\n' +
                        '- ปฏิบัติหน้าที่ถูกต้องตามกฎหมายและระเบียบ ไม่เลือกปฏิบัติ\n' +
                        '- แสดงความคิดเห็นตามหลักวิชาชีพด้วยความสุจริตใจ\n\n' +
                    'ระดับที่ 2 แสดงสมรรถนะระดับที่ 1 และเป็นผู้มีสัจจะเชื่อถือได้\n' +
                        '- รักษาคำพูด มีความรับผิดชอบ และได้รับความไว้วางใจจากผู้อื่น\n' +
                        '- แสดงให้เห็นถึงความภูมิใจในความเป็นข้าราชการ พนักงานของตน\n\n' +
                    'ระดับที่ 3 แสดงสมรรถนะระดับที่ 2 และยึดมั่นในหลักการและจรรยาบรรณ\n' +
                        '- ยึดหลักวิชาชีพและจรรยาข้าราชการ ไม่ยอมเบี่ยงเบนเพราะอคติหรือผลประโยชน์ส่วนตน\n' +
                        '- พร้อมรับผิดและเสียสละประโยชน์ส่วนตนเพื่อประโยชน์ของราชการ\n\n' +
                    'ระดับที่ 4 แสดงสมรรถนะระดับที่ 3 และยืนหยัดเพื่อความถูกต้อง\n' +
                        '- กล้าตัดสินใจและปฏิบัติอย่างถูกต้อง เป็นธรรม แม้จะสร้างความไม่พอใจให้ผู้เสียประโยชน์\n' +
                        '- มุ่งพิทักษ์ผลประโยชน์ของทางราชการแม้อยู่ในสถานการณ์ที่กดดัน\n\n' +
                    'ระดับที่ 5 แสดงสมรรถนะระดับที่ 4 และอุทิศตนเพื่อความยุติธรรมในระดับกว้าง\n' +
                        '- ยืนหยัดปกป้องผลประโยชน์และชื่อเสียงของประเทศชาติ แม้อาจเสี่ยงต่อความมั่นคงในหน้าที่หรือตนเอง',

                5: 'คำอธิบาย ก.5 การทำงานเป็นทีม\n\n' +
                    'ความตั้งใจที่จะทำงานร่วมกับผู้อื่น เป็นส่วนหนึ่งของทีม หน่วยงาน หรือสถาบันอุดมศึกษา ' +
                    'โดยผู้ปฏิบัติมีฐานะเป็นสมาชิก ไม่จำเป็นต้องเป็นหัวหน้าทีม และสามารถสร้างและรักษาสัมพันธภาพที่ดีกับสมาชิกในทีม\n\n' +
                    'ระดับที่ 0 ไม่แสดงสมรรถนะด้านนี้ หรือแสดงอย่างไม่ชัดเจน\n\n' +
                    'ระดับที่ 1 ทำหน้าที่ของตนในทีมได้สำเร็จ\n' +
                    '- สนับสนุนการตัดสินใจของทีม และปฏิบัติงานตามที่ได้รับมอบหมาย\n' +
                    '- รายงานความคืบหน้าของงานตนเองต่อทีม และให้ข้อมูลที่เป็นประโยชน์ต่อการทำงานร่วมกัน\n\n' +
                    'ระดับที่ 2 แสดงสมรรถนะระดับที่ 1 และให้ความร่วมมือกับเพื่อนร่วมงาน\n' +
                    '- เข้ากับผู้อื่นในทีมได้ดีและให้ความร่วมมือในการทำงาน\n' +
                    '- กล่าวถึงเพื่อนร่วมงานในเชิงสร้างสรรค์และแสดงความเชื่อมั่นในศักยภาพของทีม\n\n' +
                    'ระดับที่ 3 แสดงสมรรถนะระดับที่ 2 และช่วยประสานความร่วมมือของทีม\n' +
                    '- รับฟังความคิดเห็นของสมาชิก และพร้อมเรียนรู้จากผู้อื่น\n' +
                    '- วางแผนหรือตัดสินใจร่วมกันบนพื้นฐานของความคิดเห็นของทีม\n' +
                    '- ส่งเสริมสัมพันธภาพภายในทีมให้เกื้อกูลต่อการทำงาน\n\n' +
                    'ระดับที่ 4 แสดงสมรรถนะระดับที่ 3 และช่วยเหลือเพื่อนร่วมทีมเพื่อให้งานสำเร็จ\n' +
                    '- ให้กำลังใจและยกย่องผลงานของเพื่อนร่วมทีมอย่างจริงใจ\n' +
                    '- ยื่นมือช่วยเหลือเพื่อนร่วมทีมแม้ไม่ได้ร้องขอ และรักษามิตรภาพที่ดี\n\n' +
                    'ระดับที่ 5 แสดงสมรรถนะระดับที่ 4 และนำทีมให้ปฏิบัติภารกิจบรรลุผล\n' +
                    '- ส่งเสริมความสามัคคีในทีม ไม่ยึดติดความชอบส่วนตัว\n' +
                    '- ช่วยคลี่คลายและจัดการข้อขัดแย้งในทีม\n' +
                    '- ประสานสัมพันธ์และสร้างขวัญกำลังใจ เพื่อให้ทีมบรรลุเป้าหมายของสถาบันอุดมศึกษา'

            },
  
            otherDescriptions: {
                12: 'คำอธิบาย ค.1 สภาวะผู้นำ\n\n' +
                    'ความสามารถ หรือความตั้งใจที่จะรับบทในการเป็นผู้นำของกลุ่ม กำหนดทิศทาง เป้าหมาย วิธีการทำงาน ' +
                    'ให้ทีมปฏิบัติงานได้อย่างราบรื่น เต็มประสิทธิภาพและบรรลุวัตถุประสงค์ของส่วนราชการ\n\n' +
                    'ระดับที่ 0 ไม่แสดงสมรรถนะด้านนี้ หรือแสดงอย่างไม่ชัดเจน\n\n' + 
                    'ระดับที่ 1 ดำเนินการประชุมได้ดีและคอยแจ้งข่าวสารความเป็นไปโดยตลอด\n' +
                    '- ดำเนินการประชุมให้เป็นไปตามระเบียบ วาระ วัตถุประสงค์ และเวลา ตลอดจนมอบหมายงานให้แก่บุคคลในกลุ่มได้\n' +
                    '- แจ้งข่าวสารให้ผู้ที่จะได้รับผลกระทบจากการตัดสินใจรับทราบอยู่เสมอแม้ไม่ได้ถูกกำหนดให้ต้องกระทำ\n' +
                    '- อธิบายเหตุผลในการตัดสินใจให้ผู้ที่เกี่ยวข้องทราบ\n\n' + 
                    'ระดับที่ 2 แสดงสมรรถนะระดับที่ 1 และเป็นผู้นำในการทำงานของกลุ่มและใช้อำนาจอย่างยุติธรรม\n' +
                    '- ส่งเสริมและกระทำการเพื่อให้กลุ่มปฏิบัติหน้าที่ได้อย่างเต็มประสิทธิภาพ\n' +
                    '- กำหนดเป้าหมาย ทิศทางที่ชัดเจน จัดกลุ่มงานและเลือกคนให้เหมาะกับงาน หรือกำหนดวิธีการที่จะทำให้กลุ่มทำงานได้ดีขึ้น\n' +
                    '- รับฟังความคิดเห็นของผู้อื่น\n' +
                    '- สร้างขวัญกำลังใจในการปฏิบัติงาน\n' +
                    '- ปฏิบัติต่อสมาชิกในทีมด้วยความยุติธรรม\n\n' + 
                    'ระดับที่ 3 แสดงสมรรถนะระดับที่ 2 และให้การดูแลและช่วยเหลือทีมงาน\n' +
                    '- เป็นที่ปรึกษาและช่วยเหลือทีมงาน\n' +
                    '- ปกป้องทีมงาน และชื่อเสียงของส่วนราชการ\n' +
                    '- จัดหาบุคลากร ทรัพยากร หรือข้อมูลที่สำคัญมาให้ทีมงาน\n\n' + 
                    'ระดับที่ 4 แสดงสมรรถนะระดับที่ 3 และประพฤติตนสมกับเป็นผู้นำ\n' +
                    '- กำหนดธรรมเนียมปฏิบัติประจำกลุ่มและประพฤติตนอยู่ในกรอบของธรรมเนียมปฏิบัตินั้น\n' +
                    '- ประพฤติปฏิบัติตนเป็นแบบอย่างที่ดี\n' +
                    '- ยึดหลักธรรมาภิบาลในการปกครองผู้ใต้บังคับบัญชา\n\n' +    
                    'ระดับที่ 5 แสดงสมรรถนะระดับที่ 4 และผลักดันให้เกิดการปรับเปลี่ยนอย่างมีประสิทธิภาพ\n' +
                    '- ผลักดันให้การปรับเปลี่ยนสามารถดำเนินไปได้อย่างราบรื่นและประสบความสำเร็จ\n' +
                    '- สร้างขวัญกำลังใจ และความเชื่อมั่นในการขับเคลื่อนให้เกิดการปรับเปลี่ยนอย่างมีประสิทธิภาพ', 

               13: 'คำอธิบาย ค.2 วิสัยทัศน์\n\n' +
                    'ความสามารถในการกำหนดทิศทาง ภารกิจ และเป้าหมายการทำงานที่ชัดเจน ' +
                    'พร้อมทั้งสร้างความร่วมแรงร่วมใจเพื่อให้งานของส่วนราชการบรรลุวิสัยทัศน์ที่ตั้งไว้\n\n' +
                    'ระดับที่ 0 ไม่แสดงสมรรถนะด้านนี้ หรือแสดงอย่างไม่ชัดเจน\n\n' +
                    'ระดับที่ 1 รู้และเข้าใจวิสัยทัศน์ขององค์กร\n' +
                    '- เข้าใจว่างานที่ตนรับผิดชอบเชื่อมโยงหรือสนับสนุนวิสัยทัศน์ของส่วนราชการอย่างไร\n' +
                    '- สามารถอธิบายให้ผู้อื่นเข้าใจความเชื่อมโยงระหว่างงานกับวิสัยทัศน์ได้\n\n' +
                    'ระดับที่ 2 แสดงสมรรถนะระดับที่ 1 และช่วยให้ผู้อื่นเข้าใจวิสัยทัศน์ขององค์กร\n' +
                    '- ถ่ายทอดให้บุคลากรเข้าใจภาพรวมของวิสัยทัศน์และเป้าหมายของหน่วยงานภายใต้ส่วนราชการ\n' +
                    '- เปิดโอกาสแลกเปลี่ยนข้อมูลและรับฟังความคิดเห็นเพื่อใช้ประกอบการกำหนดวิสัยทัศน์\n\n' +
                    'ระดับที่ 3 แสดงสมรรถนะระดับที่ 2 และสร้างแรงจูงใจให้ผู้อื่นร่วมเดินตามวิสัยทัศน์\n' +
                    '- โน้มน้าวให้สมาชิกเกิดความเต็มใจและกระตือรือร้นในการทำงานเพื่อตอบสนองวิสัยทัศน์\n' +
                    '- ให้คำปรึกษาแนะนำแนวทางการทำงานโดยยึดวิสัยทัศน์และเป้าหมายขององค์กรเป็นหลัก\n\n' +
                    'ระดับที่ 4 แสดงสมรรถนะระดับที่ 3 และกำหนดนโยบายให้สอดคล้องกับวิสัยทัศน์ของส่วนราชการ\n' +
                    '- พัฒนาหรือริเริ่มนโยบายใหม่ๆ เพื่อผลักดันการนำวิสัยทัศน์ไปสู่ผลลัพธ์ที่เป็นรูปธรรม\n\n' +
                    'ระดับที่ 5 แสดงสมรรถนะระดับที่ 4 และกำหนดวิสัยทัศน์ของส่วนราชการให้สอดคล้องกับวิสัยทัศน์ระดับประเทศ\n' +
                    '- กำหนดวิสัยทัศน์ เป้าหมาย และทิศทางการปฏิบัติหน้าที่ของส่วนราชการให้สอดคล้องวิสัยทัศน์ระดับประเทศ\n' +
                    '- มองการณ์ไกลวิเคราะห์ได้ว่าประเทศจะได้รับผลกระทบอย่างไรจากการเปลี่ยนแปลงทั้งภายในและภายนอก',

                14: 'คำอธิบาย ค.3 การวางกลยุทธ์ภาครัฐ\n\n' +
                    'ความเข้าใจวิสัยทัศน์และนโยบายภาครัฐ แล้วนำมาประยุกต์ใช้ในการกำหนดกลยุทธ์ของส่วนราชการให้เหมาะสมกับบทบาทภารกิจของหน่วยงาน\n\n' +
                    'ระดับที่ 0 ไม่แสดงสมรรถนะด้านนี้ หรือแสดงอย่างไม่ชัดเจน\n\n' +
                    'ระดับที่ 1 รู้และเข้าใจนโยบาย ภารกิจ และกลยุทธ์ภาครัฐที่เกี่ยวข้องกับหน่วยงาน\n' +
                    '- เข้าใจความเชื่อมโยงของนโยบายและภารกิจของภาครัฐกับภารกิจของหน่วยงานที่ดูแล\n' +
                    '- วิเคราะห์ปัญหา อุปสรรค หรือโอกาสของหน่วยงานได้ในระดับหนึ่ง\n\n' +
                    'ระดับที่ 2 แสดงสมรรถนะระดับที่ 1 และนำประสบการณ์มาประยุกต์ใช้ในการกำหนดกลยุทธ์\n' +
                    '- ใช้ประสบการณ์ที่มีมาช่วยกำหนดกลยุทธ์ของหน่วยงานให้สอดคล้องกับกลยุทธ์ภาครัฐ\n' +
                    '- ปรับกลยุทธ์ให้เหมาะกับสถานการณ์ที่เปลี่ยนไปโดยอาศัยความเข้าใจระบบราชการ\n\n' +
                    'ระดับที่ 3 แสดงสมรรถนะระดับที่ 2 และนำทฤษฎีหรือแนวคิดที่ซับซ้อนมาใช้กำหนดกลยุทธ์\n' +
                    '- ประยุกต์ใช้ทฤษฎี แนวคิด หรือองค์ความรู้เชิงลึกเพื่อกำหนดเป้าหมายและกลยุทธ์ของหน่วยงาน\n' +
                    '- นำแนวปฏิบัติที่ประสบความสำเร็จหรือผลการวิจัยมาพัฒนากลยุทธ์เชิงรุกของหน่วยงาน\n\n' +
                    'ระดับที่ 4 แสดงสมรรถนะระดับที่ 3 และกำหนดกลยุทธ์ให้สอดคล้องกับสถานการณ์สำคัญต่างๆ\n' +
                    '- ประเมินสถานการณ์ด้านเศรษฐกิจ สังคม การเมือง ทั้งในประเทศและต่างประเทศในภาพรวม\n' +
                    '- คาดการณ์แนวโน้มในอนาคตและกำหนดกลยุทธ์ที่ช่วยให้ส่วนราชการบรรลุพันธกิจภายใต้สถานการณ์นั้น\n\n' +
                    'ระดับที่ 5 แสดงสมรรถนะระดับที่ 4 และบูรณาการองค์ความรู้ใหม่มาใช้กำหนดกลยุทธ์ภาครัฐ\n' +
                    '- ริเริ่มและบูรณาการองค์ความรู้ใหม่จากหลายด้านเพื่อกำหนดกลยุทธ์ภาครัฐในมุมมององค์รวม\n' +
                    '- ปรับทิศทางกลยุทธ์การพัฒนาประเทศอย่างต่อเนื่องให้สอดรับกับบริบทที่เปลี่ยนแปลง',

                15: 'คำอธิบาย ค.4 ศักยภาพเพื่อนำการปรับเปลี่ยน\n\n' +
                    'ความสามารถในการผลักดันหน่วยงานไปสู่การปรับเปลี่ยนที่เป็นประโยชน์ ' +
                    'พร้อมทั้งสื่อสารให้ผู้เกี่ยวข้องเข้าใจและร่วมมือจนการเปลี่ยนแปลงเกิดขึ้นจริงในองค์กร\n\n' +
                    'ระดับที่ 0 ไม่แสดงสมรรถนะด้านนี้ หรือแสดงอย่างไม่ชัดเจน\n\n' +
                    'ระดับที่ 1 เห็นความจำเป็นของการปรับเปลี่ยนและปรับตัวของตนเอง\n' +
                    '- ปรับพฤติกรรมหรือแผนการทำงานของตนให้สอดคล้องกับการเปลี่ยนแปลง\n' +
                    '- ยอมรับและเรียนรู้เพื่อให้สามารถปรับตัวต่อการเปลี่ยนแปลงนั้นได้\n\n' +
                    'ระดับที่ 2 แสดงสมรรถนะระดับที่ 1 และช่วยให้ผู้อื่นเข้าใจการปรับเปลี่ยนที่จะเกิดขึ้น\n' +
                    '- อธิบายให้ผู้อื่นเข้าใจถึงความจำเป็นและประโยชน์ของการเปลี่ยนแปลง\n' +
                    '- สนับสนุนและมีส่วนร่วมในความพยายามปรับเปลี่ยนองค์กร พร้อมเสนอแนวทางปรับปรุง\n\n' +
                    'ระดับที่ 3 แสดงสมรรถนะระดับที่ 2 และกระตุ้นให้ผู้อื่นเห็นความสำคัญของการปรับเปลี่ยน\n' +
                    '- สร้างแรงจูงใจให้บุคลากรเห็นความจำเป็นและร่วมมือกันในการเปลี่ยนแปลง\n' +
                    '- ชี้ให้เห็นความแตกต่างที่มีนัยสำคัญระหว่างสภาพเดิมกับสิ่งที่จะเปลี่ยนไป\n' +
                    '- ช่วยสร้างความเข้าใจกับผู้ที่ยังไม่ยอมรับการเปลี่ยนแปลง\n\n' +
                    'ระดับที่ 4 แสดงสมรรถนะระดับที่ 3 และวางแผนงานเพื่อรองรับการเปลี่ยนแปลงในองค์กร\n' +
                    '- วางแผนการเปลี่ยนแปลงอย่างเป็นระบบและชี้ให้เห็นประโยชน์ที่องค์กรจะได้รับ\n' +
                    '- เตรียมแผนและติดตามการบริหารการเปลี่ยนแปลงอย่างต่อเนื่อง\n\n' +
                    'ระดับที่ 5 แสดงสมรรถนะระดับที่ 4 และผลักดันให้การปรับเปลี่ยนเกิดผลอย่างมีประสิทธิภาพ\n' +
                    '- ทำให้กระบวนการเปลี่ยนแปลงดำเนินไปอย่างราบรื่นและประสบผลสำเร็จ\n' +
                    '- สร้างขวัญกำลังใจและความเชื่อมั่นในการขับเคลื่อนการเปลี่ยนแปลงขององค์กร',

                16: 'คำอธิบาย ค.5 การสอนงานและการมอบหมายงาน\n\n' +
                    'ความตั้งใจส่งเสริมการเรียนรู้และการพัฒนาผู้อื่นในระยะยาว ' +
                    'จนสามารถมอบหมายภาระงานและให้อิสระในการตัดสินใจปฏิบัติหน้าที่ราชการได้อย่างเหมาะสม\n\n' +
                    'ระดับที่ 0 ไม่แสดงสมรรถนะด้านนี้ หรือแสดงอย่างไม่ชัดเจน\n\n' +
                    'ระดับที่ 1 สอนงานหรือให้คำแนะนำเกี่ยวกับวิธีปฏิบัติงาน\n' +
                    '- ให้คำแนะนำหรือสาธิตวิธีปฏิบัติงานอย่างเป็นขั้นตอน\n' +
                    '- ชี้แหล่งข้อมูลหรือทรัพยากรที่เกี่ยวข้องเพื่อช่วยพัฒนาการทำงาน\n\n' +
                    'ระดับที่ 2 แสดงสมรรถนะระดับที่ 1 และตั้งใจพัฒนาผู้ใต้บังคับบัญชาให้มีศักยภาพ\n' +
                    '- ให้คำปรึกษาในการพัฒนาตนเอง ส่งเสริมจุดแข็งและช่วยลดจุดอ่อน\n' +
                    '- เปิดโอกาสให้ผู้ใต้บังคับบัญชาแสดงศักยภาพเพื่อสร้างความมั่นใจในการทำงาน\n\n' +
                    'ระดับที่ 3 แสดงสมรรถนะระดับที่ 2 และวางแผนให้โอกาสผู้ใต้บังคับบัญชาแสดงความสามารถ\n' +
                    '- วางแผนพัฒนาผู้ใต้บังคับบัญชาทั้งระยะสั้นและระยะยาว\n' +
                    '- มอบหมายงานและโอกาสเข้ารับการฝึกอบรมหรือพัฒนาอย่างสม่ำเสมอ\n' +
                    '- มอบหมายความรับผิดชอบในระดับที่ต้องตัดสินใจเองบางเรื่อง เพื่อให้ได้ฝึกบริหารจัดการงาน\n\n' +
                    'ระดับที่ 4 แสดงสมรรถนะระดับที่ 3 และช่วยขจัดอุปสรรคต่อการพัฒนาศักยภาพของผู้ใต้บังคับบัญชา\n' +
                    '- ปรับเปลี่ยนทัศนคติหรือปัจจัยที่ขัดขวางการพัฒนาศักยภาพของบุคลากร\n' +
                    '- ทำความเข้าใจสาเหตุของพฤติกรรมแต่ละคนเพื่อนำมาวางแนวทางพัฒนาได้ตรงจุด\n\n' +
                    'ระดับที่ 5 แสดงสมรรถนะระดับที่ 4 และทำให้ส่วนราชการมีระบบการสอนงานและมอบหมายงานที่ชัดเจน\n' +
                    '- สร้างและสนับสนุนให้เกิดระบบสอนงานและมอบหมายความรับผิดชอบอย่างเป็นระบบในส่วนราชการ\n' +
                    '- ส่งเสริมให้เกิดวัฒนธรรมการเรียนรู้อย่างต่อเนื่องในหน่วยงาน'
 
            },
  
            competencyMap: {},

            competencyDialogVisible: false,
            selectedCompetency: {
                title: '',
                description: ''
            },
        };   
    }, 
    async mounted(){ 
        const { signIn, getSession, signOut } = await useAuth()
        const user = await getSession();
        
        const {STAFFID, SCOPES} = user.user.name 
        const {staffdepartment, groupid, staffdepartmentname, groupname} = SCOPES
        await this.setSession(
            STAFFID,
            staffdepartment,
            groupid,
            user.user.name.POSTYPENAME,
            user.user.name.POSITIONNAMEID,
            user.user.name.POSITIONNAME
        ); 

        // โหลด master stf_compentency มา map ชื่อ → WORK_DATAIL
        this.loadCompetencyDescriptions();
    },  
    // watch: {
    //     tab2Reload(v) { 
    //         this.showdataPo();
    //         this.getjobSpecificCompetencies();
    //     },  
    //     dataPor: {
    //         handler(newVal, oldVal) {
    //             this.showdataPo();
    //             this.getjobSpecificCompetencies();
    //         },
    //         deep: true 
    //     },
    // },
    watch: {
        tab2Reload: {
            async handler() {
            await this.refreshP02();
            }
        },
        dataPor: {
            async handler() {
            await this.refreshP02();
            },
            deep: true
        }
    }, 
    methods: {  
        async refreshP02() {
            if (!this.dataPor?.d_date || !this.staffid_Main) return;
            await this.showdataPo();                 // ✅ โหลดรายการ ข. ให้เสร็จก่อน
            await this.getjobSpecificCompetencies(); // ✅ แล้วค่อยเติมคะแนน
        }, 
        setSession (staffid_Main,facid_Main,groupid_Main,postypename,postypenameid,positionname) {
            this.staffid_Main = staffid_Main
            this.facid_Main = facid_Main
            this.groupid_Main = groupid_Main   
            this.postypename = postypename    
            this.postypenameid = postypenameid    
            this.positionname = positionname   
            this.getAadioPosition(staffid_Main);
        },

        async loadCompetencyDescriptions() {
            try {
                // API นี้คืน stf_compentency ทั้งตาราง
                const res = await axios.get('http://127.0.0.1:8000/api/competencies');
                const map = {};
                (res.data || []).forEach(item => {
                    if (item.WORK_NAME) {
                        map[item.WORK_NAME.trim()] = item;
                    }
                });
                this.competencyMap = map;
            } catch (e) {
                console.error('loadCompetencyDescriptions error', e);
            }
        },

        async getAadioPosition(staffid_Main){
            try {   
                if (staffid_Main) {
                    const res = await axios.get(' http://127.0.0.1:8000/api/getDataAdio', {  
                        params: { staffid: staffid_Main }
                    }); 
                    this.posadio = res.data[0].posadid
                } 
            } catch (error) {
                console.error('Error fetching evaluation data:', error);
            } 
        },

        //  getjobSpecificCompetencies(){
        //     axios.post('   http://127.0.0.1:8000/api/showdataposp02', { 
        //         p_year: this.dataPor.d_date,
        //         evalua: this.dataPor.evalua,
        //         p_staffid: this.staffid_Main
        //     })
        //     .then(res => {
        //         for (let i = 0; i < this.jobSpecificCompetencies.length; i++) {
        //             if (res.data[0] && res.data[0][`p${i+6}`] !== undefined) {
        //                 this.jobSpecificCompetencies[i]['SCORE'] = res.data[0][`p${i+6}`];
        //                 this.jobSpecificCompetencies[i]['SCOREPERSON'] = res.data[0][`pa_${i+6}`];
        //             }
        //         }
        //         for (let i = 0; i < this.otherCompetencies.length; i++) {
        //             if (res.data[0] && res.data[0][`px_${i+1}`] !== undefined) {
        //                 this.otherCompetencies[i]['datatable3'] = res.data[0][`px_${i+1}`];
        //                 this.otherCompetencies[i]['selfAssessment3'] = res.data[0][`pSE_${i+1}`]; 
        //             }  
        //         }
        //     })
        // },
        async getjobSpecificCompetencies() {
            const res = await axios.post('http://127.0.0.1:8000/api/showdataposp02', {
                p_year: this.dataPor.d_date,
                evalua: this.dataPor.evalua,
                p_staffid: this.staffid_Main
            });

            const row = res.data?.[0] || {};

            // ใส่คะแนนตาราง ข.
            this.jobSpecificCompetencies = this.jobSpecificCompetencies.map((it, i) => ({
                ...it,
                SCORE: row[`p${i + 6}`] ?? it.SCORE ?? null,
                SCOREPERSON: row[`pa_${i + 6}`] ?? it.SCOREPERSON ?? null
            }));

            // ใส่คะแนนตาราง ค.
            this.otherCompetencies = this.otherCompetencies.map((it, i) => ({
                ...it,
                datatable3: row[`px_${i + 1}`] ?? it.datatable3 ?? '',
                selfAssessment3: row[`pSE_${i + 1}`] ?? it.selfAssessment3 ?? ''
            }));
        },
        
        //บิวแก้090269
        // showdataPo(){   
        //     //  let postypetext = ['128'].includes(this.posadio) ? `ระดับชำนาญการพิเศษ` : `ระดับ${this.postypename}`;
        //     //  let postypenameid = ['128'].includes(this.posadio) ? 90 : this.postypenameid;
        //     //  let positionname = ['128'].includes(this.posadio) ? `ระดับชำนาญการพิเศษ` : `ระดับ${this.postypename}`; 
             
        //     let postypetext = this.posadio === '128' ? `ระดับชำนาญการพิเศษ` : `ระดับ${this.postypename}`; 
        //     let postypenameid = this.posadio === '128' ? 90 : this.postypenameid;
        //     let positionname = this.posadio === '128' ? `ระดับชำนาญการพิเศษ` : `ระดับ${this.postypename}`;  
    
        //     // console.log(postypenameid, 'postypenameid');

        //     const levelMapping = {
        //         'ระดับปฏิบัติการ': 1,
        //         'ระดับปฏิบัติงาน': 1, 
        //         'ระดับชำนาญการ': 2,
        //         'ระดับชำนาญงาน': 2,
        //         'ระดับชำนาญการพิเศษ': 3,
        //         'ระดับชำนาญงานพิเศษ': 3,
        //         'อาจารย์': 3,
        //         'ระดับเชี่ยวชาญ': 4,
        //         'ระดับเชี่ยวชาญพิเศษ': 5
        //     };
  
        //     let personnel = levelMapping[postypetext] || 0;

        //     this.coreCompetencies = [
        //         { id: 1, activity: 'ก. 1 การมุ่งผลสัมฤทธิ์', indicator: personnel, data_table1: '', selfAssessment: '' },
        //         { id: 2, activity: 'ก. 2 การบริการที่ดี', indicator: personnel, data_table1: '', selfAssessment: '' },
        //         { id: 3, activity: 'ก. 3 การสั่งสมความเชี่ยวชาญในงานอาชีพ', indicator: personnel, data_table1: '', selfAssessment: '' },
        //         { id: 4, activity: 'ก. 4 การยึดมั่นในความถูกต้องชอบธรรมและจริยธรรม', indicator: personnel, data_table1: '', selfAssessment: '' },
        //         { id: 5, activity: 'ก. 5 การทำงานเป็นทีม', indicator: personnel, data_table1: '', selfAssessment: '' }
        //     ];
             
        //     this.jobSpecificCompetencies = [];  

        //     const Mapping = { '128': 1 };   
        //     const blacklist = ['110105', '110146', '160018',];  //ต้องการให้ผู้บริหารไม่ขึ้นเลข1 ค. ให้ใส่staffid
        //     let executive = Mapping[this.posadio] || 0;
        //     if (blacklist.includes(String(this.staffid_Main))) {
        //         executive = 0;
        //     }

        //     this.otherCompetencies = [
        //         { id: 12, activity: 'ค. 1 สภาวะผู้นำ', indicator3: executive, datatable3: '', selfAssessment3: '' },
        //         { id: 13, activity: 'ค. 2 วิสัยทัศน์', indicator3: executive, datatable3: '', selfAssessment3: '' },
        //         { id: 14, activity: 'ค. 3 การวางกลยุทธ์ภาครัฐ', indicator3: executive, datatable3: '', selfAssessment3: '' },
        //         { id: 15, activity: 'ค. 4 ศักยภาพเพื่อนำการปรับเปลี่ยน', indicator3: executive, datatable3: '', selfAssessment3: '' },
        //         { id: 16, activity: 'ค. 5 การสอนงานและการมอบหมายงาน', indicator3: executive, datatable3: '', selfAssessment3: '' }
        //     ];
  
        //     this.showPostype(positionname, postypenameid);
  
        //     axios.post('   http://127.0.0.1:8000/api/showDataPo',{
        //         staff_id: this.staffid_Main,
        //         fac_id: this.facid_Main,
        //         year_id: this.dataPor.d_date,
        //         record: this.dataPor.evalua,
        //         postypename: postypetext
        //         }).then(res => {     
        //         if (res.data.length > 0) {
        //             const data = res.data[0]; 
        //             this.coreCompetencies = this.coreCompetencies.map(item => {
        //                 if (data[`p${item.id}`] !== undefined) {
        //                     return {
        //                         ...item,
        //                         data_table1: data[`p${item.id}`],
        //                         selfAssessment: data[`pa_${item.id}`]
        //                     };
        //                 }
        //                 return item;
        //             });  
        //             this.improvements = data.improvements ?? '- ไม่มีข้อมูล -';
        //             this.suggestions = data.suggestions ?? '- ไม่มีข้อมูล -'; 
        //         } 
        //     })
        //     .catch(error => {
        //         console.error('Error:', error);
        //     });
        // },

        

        async showdataPo() {

            // 🔹 เงื่อนไขระดับชำนาญการพิเศษ
            const isSpecialExpert = this.posadio === '128' || (this.postypenameid === '137' && this.positionname === 'ผู้บริหาร'); 
                let postypetext = isSpecialExpert ? 'ระดับชำนาญการพิเศษ' : `ระดับ${this.postypename}`; 
                let postypenameid = isSpecialExpert ? 90 : this.postypenameid; 
                let positionname = isSpecialExpert ? 'ระดับชำนาญการพิเศษ' : `ระดับ${this.postypename}`; 

            const levelMapping = {
                'ระดับปฏิบัติการ': 1,
                'ระดับปฏิบัติงาน': 1,
                'ระดับชำนาญการ': 2,
                'ระดับชำนาญงาน': 2,
                'ระดับชำนาญการพิเศษ': 3,
                'ระดับชำนาญงานพิเศษ': 3,
                'อาจารย์': 3,
                'ระดับเชี่ยวชาญ': 4,
                'ระดับเชี่ยวชาญพิเศษ': 5
            }; 
            let personnel = levelMapping[postypetext] || 0;
 
            this.coreCompetencies = [
                { id: 1, activity: 'ก. 1 การมุ่งผลสัมฤทธิ์', indicator: personnel, data_table1: '', selfAssessment: '' },
                { id: 2, activity: 'ก. 2 การบริการที่ดี', indicator: personnel, data_table1: '', selfAssessment: '' },
                { id: 3, activity: 'ก. 3 การสั่งสมความเชี่ยวชาญในงานอาชีพ', indicator: personnel, data_table1: '', selfAssessment: '' },
                { id: 4, activity: 'ก. 4 การยึดมั่นในความถูกต้องชอบธรรมและจริยธรรม', indicator: personnel, data_table1: '', selfAssessment: '' },
                { id: 5, activity: 'ก. 5 การทำงานเป็นทีม', indicator: personnel, data_table1: '', selfAssessment: '' }
            ];

             
            this.jobSpecificCompetencies = [];

           
            // const Mapping = { '128': 1 };
            // const blacklist = ['110105', '110146', '160018']; // staffid ที่ไม่ให้ขึ้น ค.


            // let executive = Mapping[this.posadio] || 0; 
            // console.log('posadio:', executive); 
            // if (blacklist.includes(String(this.staffid_Main))) {
            //     executive = 0;
            // }

            //รอใส่230269
            const staffId = String(this.staffid_Main).trim(); 
            // ✅ ให้ขึ้น ค. เฉพาะคนใน allowlist
            let executive = EXECUTIVE_ALLOWLIST.has(staffId) ? 1 : 0; 
            console.log('staffId:', staffId, 'executive:', executive);


            this.otherCompetencies = [
                { id: 12, activity: 'ค. 1 สภาวะผู้นำ', indicator3: executive, datatable3: '', selfAssessment3: '' },
                { id: 13, activity: 'ค. 2 วิสัยทัศน์', indicator3: executive, datatable3: '', selfAssessment3: '' },
                { id: 14, activity: 'ค. 3 การวางกลยุทธ์ภาครัฐ', indicator3: executive, datatable3: '', selfAssessment3: '' },
                { id: 15, activity: 'ค. 4 ศักยภาพเพื่อนำการปรับเปลี่ยน', indicator3: executive, datatable3: '', selfAssessment3: '' },
                { id: 16, activity: 'ค. 5 การสอนงานและการมอบหมายงาน', indicator3: executive, datatable3: '', selfAssessment3: '' }
            ];
 
        await this.showPostype(positionname, postypenameid); 
            axios.post('http://127.0.0.1:8000/api/showDataPo', {
                staff_id: this.staffid_Main,
                fac_id: this.facid_Main,
                year_id: this.dataPor.d_date,
                record: this.dataPor.evalua,
                postypename: postypetext
            })
            .then(res => {
                if (res.data.length > 0) {
                    const data = res.data[0];

                    this.coreCompetencies = this.coreCompetencies.map(item => {
                        if (data[`p${item.id}`] !== undefined) {
                            return {
                                ...item,
                                data_table1: data[`p${item.id}`],
                                selfAssessment: data[`pa_${item.id}`]
                            };
                        }
                        return item;
                    });

                    this.improvements = data.improvements ?? '- ไม่มีข้อมูล -';
                    this.suggestions  = data.suggestions  ?? '- ไม่มีข้อมูล -';
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        },
 
        // showPostype(postypename, postypenameid){
        //     const postypetext = postypename;
        //     axios.post('   http://127.0.0.1:8000/api/showdatapostypenameAdmin', {
        //         postypename: postypetext,
        //         postypenameid: postypenameid
        //     })
        //     .then(res => {
        //         if (res.data.length > 0) { 
        //             this.jobSpecificCompetencies = res.data;
        //         } 
        //     })
        //     .catch(error => {
        //         console.error('Error fetching data:', error); 
        //     }); 
        // },
        async showPostype(postypename, postypenameid) {
            const res = await axios.post('http://127.0.0.1:8000/api/showdatapostypenameAdmin', {
                postypename,
                postypenameid
            }); 
            // เติม field กัน undefined ไว้ก่อน
            this.jobSpecificCompetencies = (res.data || []).map(r => ({
                ...r,
                SCORE: r.SCORE ?? null,
                SCOREPERSON: r.SCOREPERSON ?? null
            }));
        },

        showdatator() {  
            axios.post('http://127.0.0.1:8000/api/showdatator', {
                p_year: this.dataPor.d_date,
                evalua: this.dataPor.evalua,
                p_staffid: this.staffid_Main
            })
            .then(res => {
                this.assessorText = res.data[0].assessor; 
                this.assessor_positionText = res.data[0].assessor_position;
                this.showscoresum = res.data[0] 
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
        },

        async printDataP01() { 
            const { signIn, getSession, signOut } = await useAuth() 
            const user = await getSession(); 
            const staffId = String(this.staffid_Main).trim()  
            const form = {
                staff_id: this.staffid_Main,
                group_id: this.groupid_Main,
                fac_id: this.dataPor.fac_id,
                year_id: this.dataPor.d_date,
                evalua: this.dataPor.evalua,
                PREFIXFULLNAME: user.user.name.PREFIXFULLNAME,
                STAFFNAME: user.user.name.STAFFNAME,
                STAFFSURNAME: user.user.name.STAFFSURNAME,
                POSITIONNAME: user.user.name.POSITIONNAME,
                GROUPTYPENAME: user.user.name.GROUPTYPENAME,
                POSTYPENAME: user.user.name.POSTYPENAME, 
                SCOPES: user.user.name.SCOPES.staffdepartmentname,
                postypename: `ระดับ${this.postypename}`,
                postypenameid: this.postypenameid,
                executive: EXECUTIVE_ALLOWLIST.has(staffId) ? 1 : 0,
                posadio: this.posadio, // (เผื่อ fallback ใน BE)

            } 
            const queryParams = new URLSearchParams(form).toString();
            const url = `http://127.0.0.1:8000/report_p02?${queryParams}`;
            window.open(url, '_blank');
        },     

        // เมื่อคลิกชื่อสมรรถนะ ให้เปิด Dialog
        openCompetencyDialog(type, row, index = null) {
            let title = '';
            let description = '';

            if (type === 'core') {
                title = row.activity;
                const workName = this.extractNameFromActivity(row.activity);
                const master = this.competencyMap[workName] || null;
                if (master) {
                    description = master.WORK_DATAIL || this.coreDescriptions[row.id] || '';
                } else {
                    description = this.coreDescriptions[row.id] || 'ยังไม่มีคำอธิบายสำหรับรายการนี้';
                }

            } else if (type === 'job') {
                const order = (index !== null ? index + 1 : '');
                title = `ข. ${order} ${row.WORK_NAME}`;

                // WORK_DATAIL + LEVEL_DETAIL (ที่ query ใหม่รวม ORDER_ID + ORDER_DETAIL มาแล้ว)
                const baseDetail = row.WORK_DATAIL || '';
                const levelDetail = row.LEVEL_DETAIL || '';
                description = baseDetail;
                if (levelDetail) {
                    description += `\n\n${levelDetail}`;
                }

            } else if (type === 'other') {
                title = row.activity;
                const workName = this.extractNameFromActivity(row.activity);
                const master = this.competencyMap[workName] || null;
                if (master) {
                    description = master.WORK_DATAIL || this.otherDescriptions[row.id] || '';
                } else {
                    description = this.otherDescriptions[row.id] || 'ยังไม่มีคำอธิบายสำหรับรายการนี้';
                }
            }

            this.selectedCompetency = { title, description };
            this.competencyDialogVisible = true;
        },

        // ตัด prefix เช่น "ก. 1 " หรือ "ค. 3 " ออก เหลือเฉพาะชื่อสมรรถนะ
        extractNameFromActivity(activityText) {
            if (!activityText) return '';
            const parts = activityText.trim().split(/\s+/);
            if (parts.length <= 2) return activityText.trim();
            return parts.slice(2).join(' ');
        }
    }  
}
</script>

<style scoped>
body {
    font-family: 'Prompt', Arial, sans-serif;
    background-color: #f5f5f5;
    margin: 0;
    padding: 0;
}
.container {
    width: 95%;
    margin: 0 auto;
    padding: 20px;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}
h3 {
    text-align: center;
    margin-bottom: 20px;
}
table {
    width: 100%;
    table-layout: fixed;
    border-collapse: collapse;
    background-color: #fff;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
}
th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
    font-size: 14px;
}
th {
    background-color: #ffffff;
}
th, td:first-child {
    width: 35%;
}
td:nth-child(2), td:nth-child(3) {
    width: 32.5%;
}
.add-row-form {
    margin: 5px 0;
    font-size: 14px;
}
.add-button, .save-button, .cancel-button {
    margin: 3px;
    padding: 6px 12px;
    font-size: 12px;
}
.form-container {
    padding: 8px;
    border: 1px solid #ddd;
    background-color: #f0f0f0;
    border-radius: 4px;
    font-size: 14px;
}
.edit-icon, .delete-icon {
    margin: 0 8px;
    cursor: pointer;
    font-size: 16px;
}
.edit-icon {
    color: #ffc107;
}
.delete-icon {
    color: #dc3545;
}
th {
    background-color: #edf2bb;
    color: rgb(5, 5, 5);
}
</style>
